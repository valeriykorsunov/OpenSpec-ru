# Начало работы

В этом руководстве объясняется, как работает OpenSpec после установки и инициализации. Инструкции по установке см. в [основном README](../README.md#quick-start).

## Как это работает

OpenSpec помогает вам и вашему ИИ-ассистенту договориться о том, что именно нужно создать, еще до написания кода. Рабочий процесс следует простому паттерну:

```
┌────────────────────┐
│ Начать изменение   │  /opsx:new
└────────┬───────────┘
         │
         ▼
┌────────────────────┐
│ Создать артефакты  │  /opsx:ff или /opsx:continue
│ (предложение,      │
│ спецификации,      │
│ дизайн, задачи)    │
└────────┬───────────┘
         │
         ▼
┌────────────────────┐
│ Выполнить задачи   │  /opsx:apply
│ (ИИ пишет код)     │
└────────┬───────────┘
         │
         ▼
┌────────────────────┐
│ Архивация и слияние│  /opsx:archive
│ спецификаций       │
└────────────────────┘
```

## Что создает OpenSpec

После запуска `openspec init` ваш проект получает следующую структуру:

```
openspec/
├── specs/              # Источник истины (поведение вашей системы)
│   └── <домен>/
│       └── spec.md
├── changes/            # Предлагаемые обновления (одна папка на изменение)
│   └── <имя-изменения>/
│       ├── proposal.md
│       ├── design.md
│       ├── tasks.md
│       └── specs/      # Дельта-спецификации (что меняется)
│           └── <домен>/
│               └── spec.md
└── config.yaml         # Конфигурация проекта (опционально)
```

**Две ключевые директории:**

- **`specs/`** — Источник истины. Эти спецификации описывают, как ваша система ведет себя в данный момент. Организованы по доменам (например, `specs/auth/`, `specs/payments/`).

- **`changes/`** — Предлагаемые модификации. Каждое изменение получает свою папку со всеми сопутствующими артефактами. Когда изменение завершено, его спецификации объединяются с основной директорией `specs/`.

## Понимание артефактов

Каждая папка изменения содержит артефакты, которые направляют работу:

| Артефакт | Назначение |
|----------|---------|
| `proposal.md` | "Почему" и "Что" — фиксирует намерения, объем и подход |
| `specs/` | Дельта-спецификации, показывающие ДОБАВЛЕННЫЕ/ИЗМЕНЕННЫЕ/УДАЛЕННЫЕ требования |
| `design.md` | "Как" — технический подход и архитектурные решения |
| `tasks.md` | Список задач для реализации с чекбоксами |

**Артефакты строятся друг на друге:**

```
предложение ──► спецификации ──► дизайн ──► задачи ──► реализация
      ▲               ▲               ▲                     │
      └───────────────┴───────────────┴─────────────────────┘
                 обновляйте по мере обучения
```

Вы всегда можете вернуться и доработать предыдущие артефакты, если в процессе реализации узнаете что-то новое.

## Как работают дельта-спецификации

Дельта-спецификации — это ключевая концепция OpenSpec. Они показывают, что именно меняется относительно ваших текущих спецификаций.

### Формат

Дельта-спецификации используют разделы для указания типа изменений:

```markdown
# Дельта для Auth

## ДОБАВЛЕННЫЕ требования (ADDED Requirements)

### Требование: Двухфакторная аутентификация
Система ДОЛЖНА требовать второй фактор при входе в систему.

#### Сценарий: Требуется OTP
- ДАНО: пользователь с включенным 2FA
- КОГДА: пользователь вводит верные учетные данные
- ТОГДА: предъявляется запрос OTP

## ИЗМЕНЕННЫЕ требования (MODIFIED Requirements)

### Требование: Тайм-аут сессии
Система ДОЛЖНА аннулировать сессии после 30 минут бездействия.
(Ранее: 60 минут)

#### Сценарий: Тайм-аут при бездействии
- ДАНО: аутентифицированная сессия
- КОГДА: проходит 30 минут без активности
- ТОГДА: сессия становится недействительной

## УДАЛЕННЫЕ требования (REMOVED Requirements)

### Требование: Запомнить меня
(Устарело в пользу 2FA)
```

### Что происходит при архивации

Когда вы архивируете изменение:

1. **ДОБАВЛЕННЫЕ** требования дописываются в основную спецификацию.
2. **ИЗМЕНЕННЫЕ** требования заменяют существующую версию.
3. **УДАЛЕННЫЕ** требования удаляются из основной спецификации.

Папка изменения перемещается в `openspec/changes/archive/` для сохранения истории аудита.

## Пример: Ваше первое изменение

Давайте разберем процесс добавления темной темы в приложение.

### 1. Начало изменения

```
Вы: /opsx:new add-dark-mode

ИИ: Создана папка openspec/changes/add-dark-mode/
    Готов к созданию: предложение (proposal)
```

### 2. Создание артефактов

Используйте `/opsx:ff` (fast-forward), чтобы создать все артефакты планирования одновременно:

```
Вы: /opsx:ff

ИИ: Создаю артефакты для add-dark-mode...
    ✓ proposal.md — зачем мы это делаем, что меняется
    ✓ specs/       — требования и сценарии
    ✓ design.md    — технический подход
    ✓ tasks.md     — список задач для реализации
    Готов к реализации!
```

### 3. Что создается

**proposal.md** — фиксирует намерения:

```markdown
# Предложение: Добавить темную тему

## Намерение
Пользователи запрашивали возможность включения темной темы для снижения 
нагрузки на глаза при использовании в ночное время.

## Объем
- Добавить переключатель темы в настройках
- Поддерживать определение системных предпочтений
- Сохранять предпочтения в localStorage

## Подход
Использовать CSS-переменные для темизации и React context 
для управления состоянием.
```

**specs/ui/spec.md** — дельта с новыми требованиями:

```markdown
# Дельта для UI

## ДОБАВЛЕННЫЕ требования

### Требование: Выбор темы
Система ДОЛЖНА позволять пользователям выбирать между светлой и темной темами.

#### Сценарий: Ручное переключение
- ДАНО: пользователь на любой странице
- КОГДА: пользователь нажимает на переключатель темы
- ТОГДА: тема меняется немедленно
- И: предпочтение сохраняется между сессиями

#### Сценарий: Системные предпочтения
- ДАНО: пользователь без сохраненных предпочтений
- КОГДА: приложение загружается
- ТОГДА: используется системная цветовая схема
```

**tasks.md** — список задач для реализации:

```markdown
# Задачи

## 1. Инфраструктура тем
- [ ] 1.1 Создать ThemeContext с состояниями light/dark
- [ ] 1.2 Добавить CSS-переменные для цветов
- [ ] 1.3 Реализовать сохранение в localStorage

## 2. UI Компоненты
- [ ] 2.1 Создать компонент ThemeToggle
- [ ] 2.2 Добавить переключатель на страницу настроек
- [ ] 2.3 Обновить Header, включив быстрый переключатель

## 3. Стилизация
- [ ] 3.1 Определить палитру цветов для темной темы
- [ ] 3.2 Обновить компоненты для использования CSS-переменных
```

### 4. Реализация

```
Вы: /opsx:apply

ИИ: Выполняю задачи...
    ✓ 1.1 Создан ThemeContext с состояниями light/dark
    ✓ 1.2 Добавлены CSS-переменные в globals.css
    ✓ 1.3 Реализовано сохранение в localStorage
    ✓ 2.1 Создан компонент ThemeToggle
    ...
    Все задачи выполнены!
```

В процессе реализации, если вы обнаружите, что дизайн требует корректировки, просто обновите артефакт и продолжайте.

### 5. Архивация

```
Вы: /opsx:archive

ИИ: Архивирую add-dark-mode...
    ✓ Спецификации объединены в openspec/specs/ui/spec.md
    ✓ Изменение перемещено в openspec/changes/archive/2025-01-24-add-dark-mode/
    Готово! Можно приступать к следующей фиче.
```

Ваши дельта-спецификации теперь стали частью основных спецификаций, документируя работу вашей системы.

## Проверка и обзор

Используйте CLI для контроля ваших изменений:

```bash
# Список активных изменений
openspec list

# Просмотр деталей изменения
openspec show add-dark-mode

# Проверка форматирования спецификаций
openspec validate add-dark-mode

# Интерактивный дашборд
openspec view
```

## Следующие шаги

- [Процессы](workflows.md) — распространенные паттерны и использование команд
- [Команды](commands.md) — полный справочник всех слеш-команд
- [Концепции](concepts.md) — глубокое понимание спецификаций, изменений и схем
- [Кастомизация](customization.md) — настройка OpenSpec под ваши нужды
