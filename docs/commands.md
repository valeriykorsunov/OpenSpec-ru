# Команды (Commands)

Это справочник слеш-команд OpenSpec. Эти команды вызываются в чат-интерфейсе вашего ИИ-ассистента (например, Claude Code, Cursor, Windsurf).

Паттерны рабочих процессов и информацию о том, когда использовать каждую команду, см. в разделе [Процессы](workflows.md). Команды терминала описаны в разделе [CLI](cli.md).

## Краткий справочник

| Команда | Назначение |
|---------|---------|
| `/opsx:explore` | Проработка идей перед созданием изменения |
| `/opsx:new` | Начать новое изменение |
| `/opsx:continue` | Создать следующий артефакт на основе зависимостей |
| `/opsx:ff` | Fast-forward: создание всех артефактов планирования одновременно |
| `/opsx:apply` | Реализовать задачи из изменения |
| `/opsx:verify` | Проверить соответствие реализации артефактам |
| `/opsx:sync` | Слить дельта-спецификации с основными спецификациями |
| `/opsx:archive` | Архивировать завершенное изменение |
| `/opsx:bulk-archive` | Архивировать несколько изменений одновременно |
| `/opsx:onboard` | Обучающее руководство по полному рабочему процессу |

---

## Справочник команд

### `/opsx:explore`

Проработка идей, исследование проблем и уточнение требований перед фиксацией изменения.

**Синтаксис:**
```
/opsx:explore [topic]
```

**Аргументы:**
| Аргумент | Обязательный | Описание |
|----------|----------|-------------|
| `topic` | Нет | Тема, которую вы хотите изучить или исследовать |

**Что она делает:**
- Открывает исследовательский диалог без обязательной структуры
- Исследует кодовую базу для ответа на вопросы
- Сравнивает варианты и подходы
- Создает визуальные диаграммы для прояснения идей
- Может переходить к `/opsx:new`, когда идеи кристаллизуются

**Пример:**
```text
Вы: /opsx:explore

ИИ: Что бы вы хотели изучить?

Вы: Как нам реализовать аутентификацию для мобильного приложения?

ИИ: Позвольте мне изучить вашу текущую настройку аутентификации...
     [Анализирует кодовую базу]

     Я вижу, что для веб-приложения вы используете аутентификацию на основе сессий.
     Для мобильных устройств у нас есть три основных варианта:

     1. JWT-токены (stateless, работают оффлайн)
     2. OAuth2 (если нужен вход через сторонние сервисы)
     3. Расширение текущих сессий (проще, но требует постоянного подключения)

     Ваш API уже настроен для CORS. Какое направление вам интересно?

Вы: Давайте выберем JWT. Можем начать изменение для этого?

ИИ: Готов, когда и вы. Запустите /opsx:new add-jwt-auth для начала.
```

**Советы:**
- Используйте, когда требования неясны или нужно провести исследование
- Во время исследования артефакты не создаются
- Подходит для сравнения нескольких подходов перед принятием решения
- Может читать файлы и искать по кодовой базе

---

### `/opsx:new`

Начать новое изменение. Создает структуру папок изменения и подготавливает её в соответствии с выбранной схемой.

**Синтаксис:**
```
/opsx:new [change-name] [--schema <schema-name>]
```

**Аргументы:**
| Аргумент | Обязательный | Описание |
|----------|----------|-------------|
| `change-name` | Нет | Имя папки изменения (запрашивается, если не указано) |
| `--schema` | Нет | Схема рабочего процесса (по умолчанию из конфига или `spec-driven`) |

**Что она делает:**
- Создает директорию `openspec/changes/<change-name>/`
- Создает файл метаданных `.openspec.yaml` в папке изменения
- Показывает шаблон первого артефакта, готового к созданию
- Запрашивает имя изменения и схему, если они не были указаны

**Что она создает:**
```
openspec/changes/<change-name>/
└── .openspec.yaml    # Метаданные изменения (схема, дата создания)
```

**Пример:**
```
Вы: /opsx:new add-dark-mode

ИИ: Создана директория openspec/changes/add-dark-mode/
     Схема: spec-driven

     Готов к созданию: proposal
     Используйте /opsx:continue для его создания или /opsx:ff для создания всех артефактов.
```

**Советы:**
- Используйте описательные имена: `add-feature`, `fix-bug`, `refactor-module`
- Избегайте общих имен, таких как `update`, `changes`, `wip`
- Схему также можно задать в конфигурации проекта (`openspec/config.yaml`)

---

### `/opsx:continue`

Создать следующий артефакт в цепочке зависимостей. Создает по одному артефакту за раз для инкрементального прогресса.

**Синтаксис:**
```
/opsx:continue [change-name]
```

**Аргументы:**
| Аргумент | Обязательный | Описание |
|----------|----------|-------------|
| `change-name` | Нет | Какое изменение продолжить (определяется из контекста, если не указано) |

**Что она делает:**
- Опрашивает граф зависимостей артефактов
- Показывает, какие артефакты готовы, а какие заблокированы
- Создает первый готовый артефакт
- Читает файлы зависимостей для получения контекста
- Показывает, что становится доступным после создания

**Пример:**
```
Вы: /opsx:continue

ИИ: Изменение: add-dark-mode

     Статус артефактов:
     ✓ proposal    (готово)
     ◆ specs       (готово к созданию)
     ◆ design      (готово к созданию)
     ○ tasks       (заблокировано — требуется: specs)

     Создаю specs...

     [Читает proposal.md, создает спецификации на основе требований]

     ✓ Создан openspec/changes/add-dark-mode/specs/ui/spec.md

     Теперь доступно: tasks
     Запустите /opsx:continue для создания следующего артефакта.
```

**Советы:**
- Используйте, если хотите просматривать каждый артефакт перед продолжением
- Подходит для сложных изменений, где важен контроль
- Несколько артефактов могут стать готовыми одновременно
- Вы можете редактировать созданные артефакты перед продолжением

---

### `/opsx:ff`

Fast-forward (быстрая перемотка) создания артефактов. Создает все артефакты планирования одновременно.

**Синтаксис:**
```
/opsx:ff [change-name]
```

**Аргументы:**
| Аргумент | Обязательный | Описание |
|----------|----------|-------------|
| `change-name` | Нет | Какое изменение ускорить (определяется из контекста, если не указано) |

**Что она делает:**
- Создает все артефакты в порядке их зависимостей
- Отслеживает прогресс через список задач
- Останавливается, когда все артефакты, помеченные как `apply-required`, завершены
- Читает каждую зависимость перед созданием следующего артефакта

**Пример:**
```
Вы: /opsx:ff add-dark-mode

ИИ: Выполняю fast-forward для add-dark-mode...

     ✓ Создаю proposal.md
     ✓ Создаю specs/ui/spec.md
     ✓ Создаю design.md
     ✓ Создаю tasks.md

     Все артефакты планирования созданы!
     Готов к реализации. Запустите /opsx:apply для начала.
```

**Советы:**
- Используйте, когда у вас есть четкое представление о том, что вы создаете
- Быстрее, чем `/opsx:continue`, для простых изменений
- Вы всё еще можете редактировать артефакты после их создания
- Подходит для небольших и средних задач

---

### `/opsx:apply`

Реализовать задачи из изменения. Проходит по списку задач, пишет код и отмечает выполненные пункты.

**Синтаксис:**
```
/opsx:apply [change-name]
```

**Аргументы:**
| Аргумент | Обязательный | Описание |
|----------|----------|-------------|
| `change-name` | Нет | Какое изменение реализовать (определяется из контекста, если не указано) |

**Что она делает:**
- Читает `tasks.md` и находит незавершенные задачи
- Работает над задачами по одной
- Пишет код, создает файлы, запускает тесты при необходимости
- Отмечает задачи как выполненные с помощью чекбоксов `[x]`

**Пример:**
```
Вы: /opsx:apply

ИИ: Реализую add-dark-mode...

     Читаю tasks.md:
     - [ ] 1.1 Создать ThemeContext
     - [ ] 1.2 Добавить кастомные CSS-свойства
     - [ ] 1.3 Реализовать сохранение в localStorage

     Работаю над 1.1: Создать ThemeContext...
     [Создает src/context/ThemeContext.tsx]

     ✓ 1.1 Завершено

     Работаю над 1.2: Добавить кастомные CSS-свойства...
     [Обновляет src/styles/globals.css]

     ✓ 1.2 Завершено
     ...
```

**Советы:**
- Можно возобновить с того места, где вы остановились, если работа была прервана
- Используйте для параллельных изменений, указывая имя изменения
- Статус выполнения отслеживается через чекбоксы в `tasks.md`

---

### `/opsx:verify`

Проверить соответствие реализации артефактам вашего изменения. Проверяет полноту, корректность и связность.

**Синтаксис:**
```
/opsx:verify [change-name]
```

**Аргументы:**
| Аргумент | Обязательный | Описание |
|----------|----------|-------------|
| `change-name` | Нет | Какое изменение проверить (определяется из контекста, если не указано) |

**Что она делает:**
- Проверяет три измерения качества реализации
- Ищет в кодовой базе доказательства реализации
- Сообщает о проблемах, классифицируя их как КРИТИЧЕСКИЕ (CRITICAL), ПРЕДУПРЕЖДЕНИЯ (WARNING) или ПРЕДЛОЖЕНИЯ (SUGGESTION)
- Не блокирует архивацию, но выявляет проблемы

**Измерения проверки:**

| Измерение | Что проверяется |
|-----------|-------------------|
| **Полнота** | Все задачи выполнены, все требования реализованы, сценарии покрыты |
| **Корректность** | Реализация соответствует намерению спецификации, граничные случаи обработаны |
| **Связность** | Решения по дизайну отражены в коде, паттерны последовательны |

**Пример:**
```
Вы: /opsx:verify

ИИ: Проверяю add-dark-mode...

     ПОЛНОТА
     ✓ Все 8 задач в tasks.md отмечены
     ✓ Все требования в спецификациях имеют соответствующий код
     ⚠ Сценарий "Определение системных предпочтений" не имеет тестового покрытия

     КОРРЕКТНОСТЬ
     ✓ Реализация соответствует намерению спецификации
     ✓ Граничные случаи из сценариев обработаны
     ✓ Состояния ошибок соответствуют определениям в спецификации

     СВЯЗНОСТЬ
     ✓ Дизайнерские решения отражены в структуре кода
     ✓ Соглашения об именовании соответствуют design.md
     ⚠ В дизайне упоминаются "CSS-переменные", но в реализации используются классы Tailwind

     ИТОГ
     ─────────────────────────────
     Критические ошибки: 0
     Предупреждения: 2
     Готов к архивации: Да (с предупреждениями)

     Рекомендации:
     1. Добавить тест для определения системных предпочтений
     2. Обновить design.md, чтобы отразить использование Tailwind, или провести рефакторинг для использования CSS-переменных
```

**Советы:**
- Запускайте перед архивацией, чтобы на раннем этапе выявить несоответствия
- Предупреждения не блокируют архивацию, но указывают на потенциальные проблемы
- Хороший способ проверить работу ИИ перед фиксацией
- Может выявить расхождения между артефактами и реализацией

---

### `/opsx:sync`

**Необязательная команда.** Сливает дельта-спецификации из изменения в основные спецификации. Команда архивации предложит синхронизацию при необходимости, поэтому обычно её не нужно запускать вручную.

**Синтаксис:**
```
/opsx:sync [change-name]
```

**Аргументы:**
| Аргумент | Обязательный | Описание |
|----------|----------|-------------|
| `change-name` | Нет | Какое изменение синхронизировать (определяется из контекста, если не указано) |

**Что она делает:**
- Читает дельта-спецификации из папки изменения
- Анализирует разделы ADDED/MODIFIED/REMOVED/RENAMED
- Сливает изменения в основную директорию `openspec/specs/`
- Сохраняет существующий контент, не упомянутый в дельте
- Не архивирует изменение (оно остается активным)

**Пример:**
```text
Вы: /opsx:sync

ИИ: Синхронизирую дельта-спецификации add-dark-mode...

     Читаю: openspec/changes/add-dark-mode/specs/ui/spec.md
     Цель:  openspec/specs/ui/spec.md

     Применяемые изменения:
     ✓ ДОБАВЛЕНО: Требование выбора темы (2 сценария)
     ✓ ДОБАВЛЕНО: Требование доступности (1 сценарий)

     Слияние...
     ✓ openspec/specs/ui/spec.md обновлен

     Изменение остается активным. Запустите /opsx:archive, когда будете готовы завершить работу.
```

**Когда использовать вручную:**

| Сценарий | Использовать sync? |
|----------|-----------|
| Долгосрочное изменение, нужны спецификации в основной ветке до архивации | Да |
| Нескольким параллельным изменениям нужны обновленные базовые спецификации | Да |
| Хотите просмотреть/проверить слияние отдельно | Да |
| Быстрое изменение, сразу переход к архивации | Нет (архивация сделает это сама) |

**Советы:**
- Синхронизация работает интеллектуально, а не простым копированием
- Можно добавлять сценарии к существующим требованиям без дублирования
- Изменение остается активным после синхронизации (не архивируется)
- Большинству пользователей не придется вызывать это напрямую — архивация предложит это при необходимости

---

### `/opsx:archive`

Архивировать завершенное изменение. Завершает изменение и перемещает его в папку архива.

**Синтаксис:**
```
/opsx:archive [change-name]
```

**Аргументы:**
| Аргумент | Обязательный | Описание |
|----------|----------|-------------|
| `change-name` | Нет | Какое изменение архивировать (определяется из контекста, если не указано) |

**Что она делает:**
- Проверяет статус завершения артефактов
- Проверяет выполнение задач (предупреждает, если не все задачи выполнены)
- Предлагает синхронизировать дельта-спецификации, если они еще не синхронизированы
- Перемещает папку изменения в `openspec/changes/archive/ГГГГ-ММ-ДД-<имя>/`
- Сохраняет все артефакты для истории и аудита

**Пример:**
```text
Вы: /opsx:archive

ИИ: Архивирую add-dark-mode...

     Статус артефактов:
     ✓ proposal.md существует
     ✓ specs/ существует
     ✓ design.md существует
     ✓ tasks.md существует (8/8 задач выполнено)

     Дельта-спецификации: Еще не синхронизированы
     → Синхронизировать сейчас? (рекомендуется)

Вы: Да

ИИ: ✓ Спецификации синхронизированы в openspec/specs/ui/spec.md
     ✓ Перемещено в openspec/changes/archive/2025-01-24-add-dark-mode/

     Изменение успешно архивировано.
```

**Советы:**
- Архивация не блокируется при наличии невыполненных задач, но выдает предупреждение
- Дельта-спецификации можно синхронизировать во время архивации или заранее
- Архивные изменения сохраняются для истории
- Сначала используйте `/opsx:verify` для выявления проблем

---

### `/opsx:bulk-archive`

Архивировать несколько завершенных изменений одновременно. Обрабатывает конфликты спецификаций между изменениями.

**Синтаксис:**
```
/opsx:bulk-archive [change-names...]
```

**Аргументы:**
| Аргумент | Обязательный | Описание |
|----------|----------|-------------|
| `change-names` | Нет | Конкретные изменения для архивации (предлагает выбрать, если не указаны) |

**Что она делает:**
- Выводит список всех завершенных изменений
- Проверяет каждое изменение перед архивацией
- Обнаруживает конфликты спецификаций между изменениями
- Разрешает конфликты, проверяя, что фактически реализовано
- Архивирует в хронологическом порядке

**Пример:**
```
Вы: /opsx:bulk-archive

ИИ: Найдено 3 завершенных изменения:
     - add-dark-mode (8/8 задач выполнено)
     - fix-login-bug (3/3 задачи выполнены)
     - update-footer (2/2 задачи выполнены)

     Проверяю конфликты спецификаций...
     ⚠ add-dark-mode и update-footer оба затрагивают specs/ui/

     Изучаю кодовую базу для разрешения...
     Оба изменения реализованы. Слияние будет выполнено в хронологическом порядке:
     1. add-dark-mode (создано 20 янв)
     2. update-footer (создано 22 янв)

     Архивировать все 3 изменения?

Вы: Да

ИИ: ✓ Архивировано add-dark-mode
     ✓ Архивировано fix-login-bug
     ✓ Архивировано update-footer
     Спецификации слиты: add-dark-mode → update-footer
```

**Советы:**
- Подходит для параллельных рабочих потоков
- Разрешение конфликтов выполняется интеллектуально (агентом)
- Изменения архивируются в порядке их создания
- Запрашивает подтверждение перед перезаписью контента спецификаций

---

### `/opsx:onboard`

Интерактивное руководство по полному рабочему процессу OpenSpec. Пошаговый туториал на примере вашей реальной кодовой базы.

**Синтаксис:**
```
/opsx:onboard
```

**Что она делает:**
- Проводит через полный цикл рабочего процесса с пояснениями
- Сканирует вашу кодовую базу на предмет реальных возможностей для улучшения
- Создает реальное изменение с настоящими артефактами
- Реализует фактическую работу (небольшие, безопасные изменения)
- Архивирует завершенное изменение
- Объясняет каждый шаг в процессе выполнения

**Фазы:**
1. Приветствие и анализ кодовой базы
2. Поиск возможности для улучшения
3. Создание изменения (`/opsx:new`)
4. Написание предложения (proposal)
5. Создание спецификаций
6. Написание дизайна
7. Создание задач
8. Реализация задач (`/opsx:apply`)
9. Проверка реализации
10. Архивация изменения
11. Итоги и следующие шаги

**Пример:**
```
Вы: /opsx:onboard

ИИ: Добро пожаловать в OpenSpec!

     Я проведу вас через полный рабочий процесс на примере вашей реальной кодовой базы.
     Мы найдем что-то небольшое для улучшения, создадим для этого полноценное изменение,
     реализуем его и заархивируем.

     Позвольте мне просканировать вашу кодовую базу на предмет возможностей...

     [Анализирует кодовую базу]

     Я нашел несколько вещей, над которыми мы могли бы поработать:
     1. Добавить валидацию ввода в контактную форму
     2. Улучшить сообщения об ошибках в процессе аутентификации
     3. Добавить состояния загрузки для асинхронных кнопок

     Что вас интересует? (или предложите свой вариант)
```

**Советы:**
- Лучший способ для новых пользователей изучить рабочий процесс
- Использует реальный код, а не абстрактные примеры
- Создает настоящее изменение, которое вы можете оставить или отменить
- Занимает 15-30 минут

---

## Синтаксис команд в различных ИИ-инструментах

Разные ИИ-инструменты используют немного отличающийся синтаксис команд. Используйте формат, соответствующий вашему инструменту:

| Инструмент | Пример синтаксиса |
|------|----------------|
| Claude Code | `/opsx:new`, `/opsx:apply` |
| Cursor | `/opsx-new`, `/opsx-apply` |
| Windsurf | `/opsx-new`, `/opsx-apply` |
| Copilot | `/opsx-new`, `/opsx-apply` |
| Trae | `/openspec-new-change`, `/openspec-apply-change` |

Функциональность идентична независимо от синтаксиса.

---

## Устаревшие команды (Legacy Commands)

Эти команды используют старый рабочий процесс "всё за один раз". Они всё еще работают, но рекомендуется использовать команды OPSX.

| Команда | Что она делает |
|---------|--------------|
| `/openspec:proposal` | Создать все артефакты сразу (предложение, спецификации, дизайн, задачи) |
| `/openspec:apply` | Реализовать изменение |
| `/openspec:archive` | Архивировать изменение |

**Когда использовать устаревшие команды:**
- В существующих проектах, использующих старый рабочий процесс
- Для простых изменений, где не нужно инкрементальное создание артефактов
- Если вам больше нравится подход "всё или ничего"

**Переход на OPSX:**
Изменения, созданные устаревшими командами, можно продолжить с помощью команд OPSX. Структура артефактов совместима.

---

## Устранение неполадок

### "Change not found" (Изменение не найдено)

Команда не смогла определить, над каким изменением нужно работать.

**Решения:**
- Укажите имя изменения явно: `/opsx:apply add-dark-mode`
- Проверьте, существует ли папка изменения: `openspec list`
- Убедитесь, что вы находитесь в правильной директории проекта

### "No artifacts ready" (Нет готовых артефактов)

Все артефакты либо завершены, либо заблокированы отсутствующими зависимостями.

**Решения:**
- Запустите `openspec status --change <name>`, чтобы увидеть, что блокирует процесс
- Проверьте наличие необходимых артефактов
- Сначала создайте недостающие артефакты-зависимости

### "Schema not found" (Схема не найдена)

Указанная схема не существует.

**Решения:**
- Выведите список доступных схем: `openspec schemas`
- Проверьте написание имени схемы
- Создайте схему, если она кастомная: `openspec schema init <name>`

### Команды не распознаются

ИИ-инструмент не распознает команды OpenSpec.

**Решения:**
- Убедитесь, что OpenSpec инициализирован: `openspec init`
- Перегенерируйте навыки: `openspec update`
- Проверьте наличие директории `.claude/skills/` (для Claude Code)
- Перезапустите ИИ-инструмент, чтобы он подхватил новые навыки

### Артефакты генерируются некорректно

ИИ создает неполные или неверные артефакты.

**Решения:**
- Добавьте контекст проекта в `openspec/config.yaml`
- Добавьте правила для конкретных артефактов для более точного руководства
- Предоставьте больше деталей в описании изменения
- Используйте `/opsx:continue` вместо `/opsx:ff` для большего контроля

---

## Следующие шаги

- [Процессы](workflows.md) — распространенные паттерны и информация о том, когда использовать каждую команду
- [CLI](cli.md) — команды терминала для управления и валидации
- [Кастомизация](customization.md) — создание кастомных схем и шаблонов
